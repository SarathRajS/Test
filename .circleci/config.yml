version: 2.1

jobs:
  build-create-dmg:
    macos:
      xcode: "15.2.0"
    environment:
      MATRIX_OS: macos-14
    steps:
      - checkout
      - run:
          name: Setup Xcode
          command: sudo xcode-select -s /Applications/Xcode_15.2.app
      - run:
          name: Build Xcode Project
          command: |
            xcodebuild clean build -project Sample.xcodeproj -scheme Sample -configuration Debug -derivedDataPath build -sdk iphonesimulator
      - run:
          name: Install create-dmg
          command: brew install create-dmg
      - run:
          name: Create a disk image using create-dmg
          command: |
            mkdir -p output
            create-dmg \
              --volname "Sample" \
              --window-pos 100 100 \
              --window-size 480 582 \
              --icon-size 128 \
              --icon "Xcode_15.2.app" 240 108 \
              --app-drop-link 240 332 \
              output/Sample_xcode_${MATRIX_OS}.dmg \
              /Applications/Xcode_15.2.app

workflows:
  version: 2
  build_and_test:
    jobs:
      - build-create-dmg:
          name: build-create-dmg-macos-14
          environment:
            MATRIX_OS: macos-14
      - build-create-dmg:
          name: build-create-dmg-macos-13
          environment:
            MATRIX_OS: macos-13
